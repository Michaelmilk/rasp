# 功能文档

本文档描述pinic系统各部分的功能。

## Nod

Node部分的主要功能是：

1. 从传感器读值；
2. 当Server要求时，返回传感器值数据；
3. 当Server要求时，返回/更新自身的配置；
4. 启动时向Server注册；
5. 定时向Server告知自己的存活。

## Server

Server部分的主要功能是：

1. 启动时向Forwarder注册；
2. 定时向Server告知自己的存活；
3. 收到来自Node的注册请求时，将它添加到自身的已知Node列表中；
4. 定时确认自身所知Node的最后存活时间，如果超时则删除；
5. 当收到来自Forwarder的请求时，读取/更新Node的配置；
6. 当收到来自Forwarder的请求时，读取/更新自身的配置；
7. 当收到来自Forwarder的请求时，返回自身知道的Node的列表；
8. -当收到来自Forwarder的请求时，返回传感器值数据；
9. -全部工作期间，以一定间隔从自身所知的所有Node查询有无超过阈值的数据，如果有则发送给Forwarder

## Forwarder

Forwarder部分的主要功能是：

1. 收到来自客户端的请求时，返回/更新自身的配置；
2. 启动时开启ssh服务；
3. 收到来自Server部分的注册请求时，将它添加到自身的已知Node列表中；
4. 定时确认自身所知所有Server的最后存活时间，如果超时则删除；
5. 收到来自客户端的**指定Server**的请求时，将请求转发给指定的Server；
6. 收到来自客户端的**监控警告**的请求后，保持连接并返回收到的警告信息给客户端。

## 客户端

客户端有如下功能：

1. 连接到某个Forwarder；
2. 获取配置/配置Forwarder；
3. 获取Forwarder所知的Server列表；
4. 获取配置/配置某个Server；
5. 获取某个Server所知的Node列表；
6. 获取配置/配置某个Node；
7. 从某个Node获取某个传感器的值；
8. 绘图：指定一个或多个Sensor，定期发送请求，获取Sensor的值；
9. 警报：长连接到Forwarder，接收警告信息。